# Notes for Project PR7411017 - Smooth Edges

** 09/22/2015 11:42 **

http://www.cbr.ugs.com/cgi-bin/tac_pr.pl?form=faults.html&entry=7411017&employee=emp&closed=Open+Non-OQ&days=7+days&display=List&db=rpt7_tac%3A%3Aus_db

D:\Scratch\PR7411017\gear_box_asmb_dwg_all_section.prt

Steps to reproduce:
1.	Open NX
2.	Open the part file above
3.	Select sheet "Revolved"
4.	RMB on imported view "Top@32"
5.	Notice that "Smooth Edges" tab is visible
6.	Configuration -> Representation -> Smart Lightweight
7.	Notice that "Smooth Edges" tab is not visible

I reproduced it successfully.

According to the dev SP, there is an issue in DrawingUI_UICompViewCommonSmoothEdges.cxx.

This doesn't actually interact with my code though...

Potentially important methods:
	IsValidForSelectedObjects() @ line 447 of DrawingUI_UICompViewCommonSmoothEdges.cxx
	update() @ line 920 of DrawingUI_UICompEditViewSettings.cxx
			 @ line 2354 of DraftingUI_UICompBaseSettings.cxx
			 @ line 189 of DrawingUI_UICompViewCommonConfiguration.cxx
			 
Tag of view: 47937

The code does hit IsValidForSelectedObjects() during the init of the view settings dialog:
 	libuicomp_draw.dll!UGS::DrawingUI::UICompViewCommonSmoothEdges::IsValidForSelectedObjects(const UGS::Drafting::EditSettingsDialogData * dialogData, bool detailIndependentFlag) Line 450	C++
 	libuicomp_draftingsettings.dll!UGS::DrawingUI::UICompEditViewSettings::ComputeValidBlockAttributeList(std::vector<unsigned int,UGS::Memory::SMAlloc<unsigned int> > selectedObjects) Line 405	C++
 	libuicomp_draftingsettings.dll!UGS::DraftingUI::UICompBaseEditSettings::implement_init(UGS::OM::MethodicObject * component) Line 406	C++
 	libuicomp_draftingsettings.dll!UGS::DrawingUI::UICompEditViewSettings::init(UGS::OM::MethodicObject * component) Line 155	C++
 	libuifw.dll!UGS::UIFW::InitializeCommandComponent(UGS::UICOMP * comp, bool isAdoptedDialog, UGS::OM::MethodicObject * component, void * initData) Line 3707	C++
 	libuifw.dll!UGS::UIFW::init_comp(UGS::UICOMP * comp, UGS::OM::MethodicObject * component, void * initData, int mark, int current, bool persistent) Line 3769	C++
 	libuifw.dll!UGS::UIFW::create_command(bool edit, bool undo, const char * class_name, UGS::OM::MethodicObject * component, void * initData) Line 4211	C++

Also, my spcific code only gets hit if selectedObjects.size() > 1. The PR steps result in a size of 1 exactly, so I don't think my code is even relevant to it.
That said, there still may be an issue with it.

Following DrawingUI_UICompViewCommonConfiguration.cxx update (when switching to SL from Exact):
	calls BASE_CLASS::update()
	this call stack doesn't really do anything at all
	enters the "viewStyleBuilder != NULL" and "viewStyleGeneralBuilder != NULL" if statements
	enters the "this->ask_event(m_settingRepresentation) != UIFW_EVENT_none || isViewRepresentationChanged" if statement 
		in the "viewStyleGeneralBuilder != NULL" if statement (@ line 287)

		
Use this watch to view the visibility of the smooth edges in UICompEditViewSettings::update():
	((UGS::UICOMP*)(((UGS::DraftingUI::UICompBaseSettings*)this)->m_viewSmoothEdges).m_value)->m_visibility

** 10/6/2015 2:13:03 PM **

Doing Drafting Tools -> Version Up on the view in question will cause the Smooth Edges toggle to be visible.

With version up going through DrawingUI_UICompViewCommonSmoothEdges.cxx IsValidForSelectedObjects():
	Skip first if statement
	Enter for loop
	Enter if(inEditMode) block but do nothing there
	Enter if(isDraftingMember) and internal else
	This sets isValid to true
	return true
	
Same thing but for non-versioned up view:
	same flow and also return true
	
This pretty much confirms in my mind that my code is unrelated, since it skips it entirely in both cases.

ApplyValueChangesBasedOnDifferentBlock() in DrawingUI_UICompViewCommonSmoothEdges.cxx
	There is a call to LDVUtilities::GetEnableSmoothEdgesForLWView() @ line 357.
	This doesn't call my code, but it does call the method that my code does also.

GetEnableSmoothEdgesForLWView() still isn't causing the issues, since it returns false in the above situation for
both Exact and Smart LW view types if the view is old.

Following after line 359 in DrawingUI_UICompViewCommonSmoothEdges(), going to Exact:
	Go inside if statement
	viewRepresentation is 1, so we skip the inner if statement
	Jump out to line 404, and go inside else block
	Keep going in until you call this->set_visibility(true);

Following, going to Smart LW:
	Go inside if statement
	viewRepresentation is 0, so we enter the inner if statement
	Since enableSmoothEdgesForLWViews is false, we enter the if statement and set the block visibility to false
	Jump out to line 404, and go inside if block
	Call this->set_visibility(true); and we're done
	
The difference when we've versioned up is enableSmoothEdgesForLWViews is true, so we don't set blockVisiblity to false

